# Бот для генерации отчетов

### Как установить бота?
------
Надо в консоли написать команду
` git clone -b dev https://gitlab.com/webinfocc/reportgen/`  
После того как проект скачалася необохдимо установить все нужные бибилиотеки
` pip install -r requirements.txt`  
Установи необходимый бразуеры для работы
` playwright install`  
  
Готово! Ты установил программу, дальше остается только запуск

### Как запустить бота?
------
Сначала обрати внимание на параметры, которые установлены в программе  
Их ты можешь найти в файле **config.ini**  
  
***Mode*** - режим в котором работает бот он может быть как ТГ-бот, так и ручным (работа с консоли)  
***Bot_Api*** - Токен бота  
  
После того как ты убедился, что все настроенно корректно можешь приступать к запуску программы. Для этого необходимо прописать следующую команду в консоли

***Запуск в фоновом режиме***  
- Windows:  
  `py runner.py start`
- MacOs / Linux:  
    `python3 runner.py start`
Проверка статуса программы в фоновом режиме:  
- Windows:  
  `py runner.py status`  
- MacOs / Linux:  
    `python3 runner.py status`  
Завершение работы программы в фоновом  
- Windows:  
  `py runner.py stop`
- MacOs / Linux:  
    `python3 runner.py stop`

***Ручной запуск***
- Windows:  
    `py api.py`
- MacOs / Linux:  
    `python3 api.py`

Доступные запросы на поднятный сервер  

|   Метод     |    Путь     |           Функционал           |
|-------------|-------------|--------------------------------|
|    GET      |  /users     | Получить список пользователей  |
|    POST     |  /users     | Добавить нового пользователя   |
|   DELETE    | /users/{id} | Удалить пользователя по ID     |
|    GET      |  /config    | Получить текущий config.ini    |
|    POST     |  /config    | Обновить значения в config.ini |
|    POST     |  /process   | Отправить файл на обработку    |
  
***Примеры запросов:***  
  
**Получить список пользовователей**  
`curl -X GET http://127.0.0.1:8000/users`  
**Добавить пользователя**  
`curl -X POST http://127.0.0.1:8000/users -H "Content-Type: application/json" -d '{"name": "USERNAME", "id": "USERID"}'`  
**Удалить пользователя**  
`curl -X DELETE http://127.0.0.1:8000/users/USERID`  
**Обработать таблицу xlsx**  
`curl -X POST http://127.0.0.1:8000/process -F "file=@PATH/TO/FILE.xlsx"`  
  
***Примеры ответов:***  

*Тест*: **Получение списка пользователей**  
*Статус*: 200  
*Ответ*: {'test_user_1': 'test_user_1_id', 'test_user_2': 'test_user_2_id'}  
  
*Тест*: **Удаление пользователя**  
*Статус*: 200  
*Ответ*: {'message': 'Пользователь с ID 12345 удален'}  
  
*Тест*: **Получение конфиг файла**  
*Статус*: 200  
*Ответ*: {'KEYS': {'bot_api': 'BOT_KEY'}, 'PARAMS': {'users': 'USERSID', 'mode': 'WORKINGMODE'}}  


### Где сохраняются скачанные файлы?
------
Все скачанные таблицы сохраняются в папке *downloads*.  
Они имеют вид *userid_filename.xlsx*  

### Хочу сменить параметры, как мне это сделать?
------
Все параметры ты можешь найти в файлике **config.ini**  
Там ты можешь поменять API_KEУ бота, сменить режим работы с ТГ-бота на ручную работу с консоли и многое другое

### Как работать с ТОКЕНАМИ пользователей?
------
Все токены и кому они выданы сохраняются в базе `users.db`  
Для работы с базой данных был создан скрипт `db.py`  
*Как с ним работать?*  
  
**Инициализация базы данных:**  
Windows: `py db.py --init`  
Linux/MacOs: `python3 db.py --init`  
  
**Добавление нового пользователя:**  
Windows: `py db.py --add username`  
Linux/MacOs: `python3 db.py --add username`  
*username* - имя пользователя  
  
**Список всех пользователей:**  
Windows: `py db.py --list`  
Linux/MacOs: `python3 db.py --list`  
  
**Показать токен пользователя:**  
Windows: `py db.py --show username password`  
Linux/MacOs: `python3 db.py --show username password`  
*username* - имя пользователя  
*password* - пароль для доступа к полным токенам пользователя, по умолчанию пароль ' '